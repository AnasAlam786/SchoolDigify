<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admit Cards</title>
    <link rel="icon" href="static/logo.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
    /* Page setup */

    @page {
        size: A4 portrait ; /* or portrait if needed */
        margin: 2mm; /* safe margin to prevent printer cutoff */
    }
    .a4-page {
        width: 297mm;
        height: 210mm;
        padding: 1mm;
        display: flex;
        flex-wrap: wrap;
        gap: 4px; /* small gap to avoid exact 50% wrapping glitches */
        justify-content: flex-start; /* prevent uneven spacing that can cause wrapping/overlap */
        margin: 0 auto;
        background-color: #fff;
    }

    /* Card container - 2 rows Ã— 2 columns per page */
    .card-container {
        width: calc(50% - 4px); /* account for gap */
        height: 49.9%;
        box-sizing: border-box;
    }

    /* Both mode - 2 cards side by side */
    .both-container {
        width: calc(50% - 4px); /* account for gap */
        height: 49.9%;
        box-sizing: border-box;
    }
    /* Ensure card content doesn't overflow and push other cards */
    .card {
        height: 100%;
        overflow: hidden; /* prevent content overflow that can overlap siblings */
    }

    /* Card styling */
    .card {
        height: 100%;
        /* border: 2px solid #000; */
        border-radius: 5px;
        padding: 5px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
    }

    /* Make all card text black by default */
    .card, 
    .card * {
        color: #000 !important;
    }

    /* Keep the Admit Card paragraph gray */
    .card-header p {
        color: #6c757d !important; /* Gray text only for this p */
    }

    /* Card header - flex to align logo and text */
    .card-header {
        display: flex;
        align-items: center;      /* vertical centering */
        gap: 10px;                /* space between logo and text */
        padding: 0.5rem;
        background-color: transparent;
        border-bottom: 1px solid #ccc;
    }

    .card-header .school-info {
        display: flex;
        flex-direction: column;
        justify-content: center;   /* vertical centering inside text column */
        align-items: center;       /* horizontally center h4 and p */
        width: 100%;               /* take remaining space */
    }

    .card-header h4 {
        font-size: 2rem;
        font-weight: 900;
        letter-spacing: 2px;
        text-transform: uppercase;
        margin: 0;
    }

    .card-header p {
        font-size: 1.5rem;
        font-weight: 500;
        color: #6c757d;           /* keep gray */
        margin: 0;
        text-align: center;        /* center this p */
    }

    /* Logo styling */
    .card-header img.logo {
        width: 90px;
        height: 90px;
        object-fit: contain;
    }

    /* Student info section */
    .student-section {
        display: flex;
        align-items: center;      /* Vertically centers image and table */
        justify-content: center;  /* Horizontally centers the whole section */
        gap: 10px;                /* Space between image and table */
    }

    .student-section img {
        width: 150px;
        height: 170px;
        object-fit: cover;
        object-position: top;
        border: 2px solid #808080;
        margin: 0;            /* Remove top margin so flex centering works */
    }

    /* Student details table */
    .student-section table {
        width: 100%;
        font-size: 1.5rem;
        border-collapse: collapse;
    }

    .student-section td {
        padding: 5px;
    }

    /* Exam scheme styling - FIXED */
    .exam-scheme {
        padding: 2px;
        height: 100%;             /* fill card space */
        box-sizing: border-box;
    }

    .exam-scheme table {
        width: 100%;
        height: 100%;             /* make table stretch */
        border-collapse: collapse;
        font-size: 0.9rem;
        table-layout: fixed;      /* align columns */
    }

    .exam-scheme thead {
        height: 20px;             /* fixed header row height */
    }

    .exam-scheme tbody {
        height: calc(100% - 40px);  /* take remaining space after header */
    }

    .exam-scheme tbody tr {
        height: calc(100% / var(--row-count)); /* distribute equally */
    }

    .exam-scheme th,
    .exam-scheme td {
        border: 1px solid #000;
        text-align: center;
        word-wrap: break-word;
        vertical-align: middle;
    }

    .exam-scheme td {
        background-color: #f8f9fa;
        font-weight: bold;
    }

    

    .exam-scheme tr:nth-child(even) {
        background-color: #f8f9fa;
    }

    .exam-scheme tr:nth-child(odd) {
        background-color: #fff;
    }


    .exam-scheme-title {
        font-size: 0.9rem;
        font-weight: bold;
        text-align: center;
        color: #000000;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Print adjustments */
    @media print {

        html, body {
            width: 297mm;
            height: 210mm;
            background: #fff;
        }
        body {
            margin: 0;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        

        .card-header h4, 
        .card-header p, 
        .student-section table {
            color: #000 !important;
        }
        
        .exam-scheme th {
            background-color: #f8f9fa !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .exam-scheme tr:nth-child(even) {
            background-color: #f8f9fa !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        /* Ensure paired admit+scheme stays together and occupies a full printed page */
        .both-wrapper {
            /* Avoid breaking the pair across pages */
            page-break-inside: avoid;
            -webkit-column-break-inside: avoid;
            break-inside: avoid;
            /* Force each pair to start on a fresh printed page */
            page-break-after: always;
            break-after: page;
        }
        /* Prevent an extra blank page after the last pair */
        .both-wrapper:last-child {
            page-break-after: auto;
            break-after: auto;
        }
    }
    </style>
</head>
<body>
    
    {% if outputType == 'admitOnly' %}
        <!-- Admit Card Only Mode -->
        {% for groups in data %}
        <div class="a4-page">
            {% for student in groups %}
                <div class="card-container">
                    <div class="card" style="border: 2px solid #000;">
                        <div class="card-header">
                            <img src="{{ logo }}" alt="School Logo" class="logo" loading="lazy">
                            <div class="school-info">
                                <h4>{{ school }}</h4>
                                <p>Admit Card {{ exam }} {{ year }}</p>
                            </div>
                        </div>

                        <div class="student-section" style="margin-top: 12px;">
                            <img src="{{ ('https://lh3.googleusercontent.com/d/' + student.IMAGE + '=s200') if student.IMAGE else '' }}" alt="Paste Photo Here">
                            <div class="ms-3 text-start">
                                <table>
                                    <tr><td style="font-weight:700">Name</td><td>{{ student.STUDENTS_NAME }}</td></tr>
                                    <tr><td style="font-weight:700">F/N</td><td>{{ student.FATHERS_NAME }}</td></tr>
                                    <tr><td style="font-weight:700">M/N</td><td>{{ student.MOTHERS_NAME }}</td></tr>
                                    <tr><td style="font-weight:700">Class</td><td>{{ student.CLASS }} - {{ student.ROLL }}</td></tr>
                                    <tr><td style="font-weight:700">DOB</td><td>{{ student.DOB }}</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        {% endfor %}
    
    {% elif outputType == 'SchemeOnly' %}
        <!-- Exam scheme Only Mode -->
        
        {% for groups in data %}
        <div class="a4-page">
            {% for student in groups %}
                <div class="card-container">
                    <div class="card" style="border: 2px solid #000;">
                        <div class="card-header">
                            <img src="{{ logo }}" alt="School Logo" class="logo" loading="lazy">
                            <div class="school-info">
                                <h4>{{ school }}</h4>
                                <p>Exam Schedule {{ exam }} {{ year }}</p>
                            </div>
                        </div>
                        
                        <div class="exam-scheme" style="--row-count: {{ examScheme|length }}">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 25%">Date</th>
                                        <th style="width: 25%">Day</th>
                                        <th style="width: 50%">Subject</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for exam in examScheme %}
                                    <tr>
                                        <td>{{ exam.date }}</td>
                                        <td>{{ exam.day }}</td>
                                        <td>{{ exam.examName }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        {% endfor %}
    
    {% elif outputType == 'both' %}
        <!-- Both Admit Card and Exam scheme Mode -->
        {% for groups in data %}
        <div class="a4-page">
            {% for student in groups %}
                <!-- Paired container: Admit Card + Exam scheme (each 50%) -->
                <!-- Admit Card - 50% width -->
                <div class="both-container" >
                    <div class="card" style="border: 2px solid #000;">
                        <div class="card-header">
                            <img src="{{ logo }}" alt="School Logo" class="logo" loading="lazy">
                            <div class="school-info">
                                <h4>{{ school }}</h4>
                                <p>Admit Card {{ exam }} {{ year }}</p>
                            </div>
                        </div>

                        <div class="student-section" style="margin-top: 12px;">
                            <img src="{{ ('https://lh3.googleusercontent.com/d/' + student.IMAGE + '=s200') if student.IMAGE else '' }}" alt="Paste Photo Here">
                            <div class="ms-3 text-start">
                                <table>
                                    <tr><td style="font-weight:700">Name</td><td>{{ student.STUDENTS_NAME }}</td></tr>
                                    <tr><td style="font-weight:700">F/N</td><td>{{ student.FATHERS_NAME }}</td></tr>
                                    <tr><td style="font-weight:700">M/N</td><td>{{ student.MOTHERS_NAME }}</td></tr>
                                    <tr><td style="font-weight:700">Class</td><td>{{ student.CLASS }} - {{ student.ROLL }}</td></tr>
                                    <tr><td style="font-weight:700">DOB</td><td>{{ student.DOB }}</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Exam scheme - 50% width -->
                <div class="both-container">
                    <div class="card" style="border: 2px solid #000;">     
                        <h4 class="exam-scheme-title">Exam Timing: 8:00 am to 11:00 am</h4>                       
                        <div class="exam-scheme" style="--row-count: {{ examScheme|length }}">
                            
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Day</th>
                                        <th>Subject</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for exam in examScheme %}
                                    <tr>
                                        <td>{{ exam.date }}</td>
                                        <td>{{ exam.day }}</td>
                                        <td>{{ exam.examName }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        {% endfor %}
    {% endif %}
    </div>
</body>
</html>