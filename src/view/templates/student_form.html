{% extends "base.html" %}
{% block title %}{{ 'Edit' if mode == 'edit' else 'Add' }} Student{% endblock %}
{% block content %}

{% from "student_detail_modal.html" import student_detail_modal %}

<style>
    /* Smooth transitions */
    .transition-all {
        transition-property: all;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 300ms;
    }

    /* Form field focus effects */
    .form-field:focus-within {
        transform: translateY(-2px);
    }

    /* Gradient borders */
    .gradient-border {
        position: relative;
        background: linear-gradient(135deg, #101010, #101010) padding-box,
            linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.3)) border-box;
        border: 1.5px solid transparent;
    }

    /* Section card hover effects */
    .section-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .section-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    /* Checkbox and radio custom styles */
    .custom-checkbox {
        position: relative;
        cursor: pointer;
    }

    .custom-checkbox input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
    }

    .checkmark {
        position: relative;
        display: inline-block;
        width: 20px;
        height: 20px;
        background: #1f2937;
        border: 2px solid #4b5563;
        border-radius: 6px;
        transition: all 0.2s;
    }

    .custom-checkbox input:checked~.checkmark {
        background: #6366f1;
        border-color: #6366f1;
    }

    .checkmark:after {
        content: "";
        position: absolute;
        display: none;
        left: 6px;
        top: 2px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }

    .custom-checkbox input:checked~.checkmark:after {
        display: block;
    }

    /* Radio card selection */
    .radio-card {
        transition: all 0.3s ease;
    }

    .radio-card:hover {
        border-color: #6366f1;
        transform: translateY(-2px);
    }

    /* Modal animations */
    @keyframes modalIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .modal-animate-in {
        animation: modalIn 0.3s ease-out forwards;
    }

    /* Better mobile headers */
    @media (max-width: 640px) {
        .mobile-header {
            padding: 1.5rem 1rem !important;
        }

        .mobile-header h1 {
            font-size: 1.75rem !important;
        }

        .mobile-section-header {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 1rem !important;
        }

        .mobile-section-header>div:first-child {
            width: 100% !important;
            justify-content: space-between !important;
        }
    }

    /* Better error message display */
    .error-message {
        display: none;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }

    .error-message.show {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #ef4444;
    }

    /* Required field indicator */
    .required::after {
        content: " *";
        color: #ef4444;
    }

    /* Compact sticky form actions */
    .compact-sticky-actions {
        backdrop-filter: blur(12px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        transform: translateY(0);
        transition: transform 0.3s ease;
    }

    .compact-sticky-actions.hidden {
        transform: translateY(100%);
    }

    /* Improved modal centering */
    .modal-center-fix {
        align-items: center;
        justify-content: center;
        display: flex !important;
    }

    /* Ensure modal is centered */
    .modal-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100%;
        padding: 1rem;
    }
</style>

<div class="max-w-6xl mx-auto sm:px-6 py-4">
    <div
        class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-[#181818] via-[#141414] to-[#0f0f0f] border border-gray-800 shadow-xl">

        <!-- Subtle background accents (reduced) -->
        <div class="absolute inset-0 pointer-events-none">
            <div
                class="absolute inset-0 bg-[radial-gradient(circle_at_15%_25%,rgba(255,255,255,0.04),transparent_45%)]">
            </div>
        </div>

        <div class="relative z-10 p-6 md:p-8">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">

                <!-- LEFT -->
                <div class="flex items-start gap-4 lg:gap-5">
                    <!-- Icon -->
                    <div
                        class="w-14 h-14 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center shadow-lg">
                        <i class="fas fa-user-plus text-white text-xl"></i>
                    </div>

                    <!-- Text -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-3">
                            <h1 class="text-xl sm:text-2xl lg:text-3xl font-semibold text-white">
                                {{ 'Edit Student' if mode == 'edit' else 'Add New Student' }}
                            </h1>
                            <span
                                class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-700/60 text-gray-200 border border-gray-600">
                                {{ 'Edit' if mode == 'edit' else 'New' }}
                            </span>
                        </div>

                        <p class="text-gray-400 text-sm max-w-xl">
                            {{ 'Update student information and details' if mode == 'edit' else 'Fill in the student
                            details to add them to the system' }}
                        </p>
                    </div>
                </div>

                <!-- ACTIONS -->
                <div class="flex flex-col sm:flex-row lg:flex-row gap-3">
                    <a href="/student_list"
                        class="inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-lg bg-gray-800 hover:bg-gray-700 border border-gray-700 text-gray-300 hover:text-white transition text-sm">
                        <i class="fas fa-arrow-left text-xs"></i>
                        Back to Students
                    </a>

                    {% if mode == 'edit' and student %}
                    <button onclick="printAdmissionForm('{{ student.id }}')"
                        class="inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-lg bg-amber-600 hover:bg-amber-500 text-white text-sm font-medium transition">
                        <i class="fas fa-print"></i>
                        Print Form
                    </button>

                    <button onclick="sendMessage('{{ student.id }}')"
                        class="inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-lg bg-green-600 hover:bg-green-500 text-white text-sm font-medium transition">
                        <i class="fab fa-whatsapp"></i>
                        Send Message
                    </button>
                    {% endif %}
                </div>

            </div>
        </div>
    </div>
</div>


<!-- Validation Summary -->
<div class="max-w-6xl mx-auto sm:px-6 mb-6">
    <div id="validationSummary"
        class="hidden rounded-xl border border-red-500/30 bg-gradient-to-r from-red-900/20 to-red-800/10 p-4 sm:p-5 backdrop-blur-sm transition-all duration-300">
        <div class="flex items-start gap-3 sm:gap-4">
            <div
                class="flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-red-500/20 flex items-center justify-center">
                <i class="fas fa-exclamation-triangle text-red-400 text-sm sm:text-lg"></i>
            </div>
            <div class="flex-1">
                <h4 class="text-red-300 font-semibold mb-2 text-base sm:text-lg">Please correct the following errors:
                </h4>
                <ul class="space-y-1.5 text-red-400/90 text-sm sm:text-base" id="errorList"></ul>
            </div>
            <button onclick="this.parentElement.parentElement.classList.add('hidden')"
                class="flex-shrink-0 text-red-400 hover:text-red-300 transition-colors">
                <i class="fas fa-times text-base sm:text-lg"></i>
            </button>
        </div>
    </div>
</div>

<!-- Main Form -->
<div class="max-w-6xl mx-auto sm:px-6 mb-24">
    <form id="DataForm" class="space-y-6">
        <!-- Personal Information Card -->
        <div class="section-card gradient-border rounded-2xl p-4 sm:p-6 bg-gray-900/50 backdrop-blur-sm">
            <!-- Card Header -->
            <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-8">
                <div class="relative">
                    <div
                        class="w-10 h-10 sm:w-14 sm:h-14 rounded-lg sm:rounded-xl bg-gradient-to-br from-indigo-600 to-purple-700 flex items-center justify-center shadow-lg">
                        <i class="fas fa-user text-white text-base sm:text-xl"></i>
                    </div>
                    <div
                        class="absolute -top-1 -right-1 w-5 h-5 sm:w-6 sm:h-6 rounded-full bg-indigo-500 border-2 border-gray-900 flex items-center justify-center">
                        <span class="text-xs font-bold text-white">1</span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl sm:text-2xl font-bold text-white">Personal Information</h2>
                    <p class="text-gray-400 text-sm">Basic details and personal information</p>
                </div>
            </div>

            <!-- Form Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                <!-- Student Name -->
                <div class="form-field">
                    <label for="STUDENTS_NAME" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Student's Name
                    </label>
                    <div class="relative">
                        <input type="text" id="STUDENTS_NAME" name="STUDENTS_NAME"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.STUDENTS_NAME if student else '' }}" required
                            placeholder="Enter full name"
                            oninput="this.value = this.value.replace(/\b\w/g, c => c.toUpperCase())">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Date of Birth -->
                <div class="form-field">
                    <label for="DOB" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Date of Birth
                    </label>
                    <div class="relative">
                        <input type="text" id="DOB" name="DOB"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.DOB.strftime('%d-%m-%Y') if student and student.DOB else '' }}" required
                            placeholder="DD-MM-YYYY">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-calendar"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Gender -->
                <div class="form-field">
                    <label for="GENDER" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Gender
                    </label>
                    <div class="relative">
                        <select id="GENDER" name="GENDER"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300 appearance-none">
                            <option value="" class="bg-gray-800">Select Gender</option>
                            {% for option in gender_options %}
                            <option value="{{ option }}" {{ 'selected' if student and student.GENDER==option else '' }}
                                class="bg-gray-800">{{ option }}</option>
                            {% endfor %}
                        </select>
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                            <i class="fas fa-chevron-down text-gray-500"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Aadhar Number -->
                <div class="form-field">
                    <label for="AADHAAR" class="block text-sm font-medium text-gray-300 mb-2">
                        Aadhar Number
                    </label>
                    <div class="relative">
                        <input type="text" id="AADHAAR" name="AADHAAR"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.AADHAAR if student and student.AADHAAR else '' }}"
                            placeholder="XXXX XXXX XXXX" maxlength="14">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-id-card"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Caste -->
                <div class="form-field">
                    <label for="Caste" class="block text-sm font-medium text-gray-300 mb-2">
                        Student's Caste
                    </label>
                    <div class="relative">
                        <input type="text" id="Caste" name="Caste"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.Caste if student and student.Caste else '' }}" placeholder="Enter caste"
                            oninput="this.value = this.value.replace(/\b\w/g, c => c.toUpperCase())">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>


                <!-- Caste Type -->
                <div class="form-field">
                    <label for="Caste_Type" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Caste Type
                    </label>
                    <div class="relative">
                        <select id="Caste_Type" name="Caste_Type"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300 appearance-none">
                            <option value="" class="bg-gray-800">Select Caste Type</option>
                            {% for option in caste_type_options %}
                            <option value="{{ option }}" {{ 'selected' if student and student.Caste_Type==option else ''
                                }} class="bg-gray-800">{{ option }}</option>
                            {% endfor %}
                        </select>
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                            <i class="fas fa-chevron-down text-gray-500"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Religion -->
                <div class="form-field">
                    <label for="RELIGION" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Religion
                    </label>
                    <div class="relative">
                        <select id="RELIGION" name="RELIGION"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300 appearance-none">
                            <option value="" class="bg-gray-800">Select Religion</option>
                            {% for option in religion_options %}
                            <option value="{{ option }}" {{ 'selected' if student and student.RELIGION==option else ''
                                }} class="bg-gray-800">{{ option }}</option>
                            {% endfor %}
                        </select>
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                            <i class="fas fa-chevron-down text-gray-500"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Height -->
                <div class="form-field">
                    <label for="Height" class="block text-sm font-medium text-gray-300 mb-2">
                        Height (cm)
                    </label>
                    <div class="relative">
                        <input type="number" id="Height" name="Height"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.Height if student and student.Height else '' }}"
                            placeholder="Enter height">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <span class="text-sm">cm</span>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Weight -->
                <div class="form-field">
                    <label for="Weight" class="block text-sm font-medium text-gray-300 mb-2">
                        Weight (kg)
                    </label>
                    <div class="relative">
                        <input type="number" id="Weight" name="Weight"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.Weight if student and student.Weight else '' }}"
                            placeholder="Enter weight">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <span class="text-sm">kg</span>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Blood Group -->
                <div class="form-field">
                    <label for="BLOOD_GROUP" class="block text-sm font-medium text-gray-300 mb-2">
                        Blood Group
                    </label>
                    <div class="relative">
                        <select id="BLOOD_GROUP" name="BLOOD_GROUP"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300 appearance-none">
                            <option value="" class="bg-gray-800">Select Blood Group</option>
                            {% for option in blood_group_options %}
                            <option value="{{ option }}" {{ 'selected' if student and student.BLOOD_GROUP==option
                                else '' }} class="bg-gray-800">{{ option }}</option>
                            {% endfor %}
                        </select>
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                            <i class="fas fa-tint text-gray-500"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Academic Details Card -->
        <div class="section-card gradient-border rounded-2xl p-4 sm:p-6 bg-gray-900/50 backdrop-blur-sm">
            <!-- Card Header -->
            <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-8">
                <div class="relative">
                    <div
                        class="w-10 h-10 sm:w-14 sm:h-14 rounded-lg sm:rounded-xl bg-gradient-to-br from-blue-600 to-cyan-700 flex items-center justify-center shadow-lg">
                        <i class="fas fa-graduation-cap text-white text-base sm:text-xl"></i>
                    </div>
                    <div
                        class="absolute -top-1 -right-1 w-5 h-5 sm:w-6 sm:h-6 rounded-full bg-blue-500 border-2 border-gray-900 flex items-center justify-center">
                        <span class="text-xs font-bold text-white">2</span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl sm:text-2xl font-bold text-white">Academic Details</h2>
                    <p class="text-gray-400 text-sm">Academic and enrollment information</p>
                </div>
            </div>

            <!-- Student Status (New/Old) - Only for add mode -->
            {% if mode == 'add' %}
            <div class="mb-6 sm:mb-8">
                <label class="block text-sm font-medium text-gray-300 mb-4 required">
                    Student Status
                </label>
                <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
                    <label class="radio-card cursor-pointer flex-1">
                        <input type="radio" name="student_status" value="new" class="peer hidden" checked>
                        <div
                            class="peer-checked:bg-gradient-to-r peer-checked:from-blue-600/20 peer-checked:to-cyan-600/20 peer-checked:border-blue-500/50 peer-checked:text-blue-400 p-4 sm:p-5 rounded-xl border-2 border-gray-800 hover:border-gray-700 transition-all duration-300">
                            <div
                                class="flex flex-col sm:flex-row items-center justify-center sm:justify-start gap-3 mb-2 sm:mb-3">
                                <div
                                    class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center">
                                    <i class="fas fa-user-plus text-white text-sm sm:text-lg"></i>
                                </div>
                                <div class="text-center sm:text-left">
                                    <div class="font-semibold text-white mb-1 text-sm sm:text-base">New Admission</div>
                                    <p class="text-xs sm:text-sm text-gray-400">First time enrollment</p>
                                </div>
                            </div>
                        </div>
                    </label>

                    <label class="radio-card cursor-pointer flex-1">
                        <input type="radio" name="student_status" value="old" class="peer hidden">
                        <div
                            class="peer-checked:bg-gradient-to-r peer-checked:from-emerald-600/20 peer-checked:to-green-600/20 peer-checked:border-emerald-500/50 peer-checked:text-emerald-400 p-4 sm:p-5 rounded-xl border-2 border-gray-800 hover:border-gray-700 transition-all duration-300">
                            <div
                                class="flex flex-col sm:flex-row items-center justify-center sm:justify-start gap-3 mb-2 sm:mb-3">
                                <div
                                    class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center">
                                    <i class="fas fa-user-graduate text-white text-sm sm:text-lg"></i>
                                </div>
                                <div class="text-center sm:text-left">
                                    <div class="font-semibold text-white mb-1 text-sm sm:text-base">Continuing Student
                                    </div>
                                    <p class="text-xs sm:text-sm text-gray-400">Previously enrolled</p>
                                </div>
                            </div>
                        </div>
                    </label>
                </div>
            </div>
            {% endif %}

            <!-- Academic Form Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                <!-- Admission Session -->
                <div class="form-field">
                    <label for="admission_session_id" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Admission Session
                    </label>
                    <div class="relative">
                        <select id="admission_session_id" name="admission_session_id"
                            data-current-session="{{ current_session }}"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300 appearance-none"
                            {{ 'disabled' if mode=='add' else '' }} required>
                            <option value="" class="bg-gray-800">Select Session</option>
                            {% for year, label in admission_sessions.items() %}
                            <option value="{{ year }}" {% if mode=='add' and year==current_session %} selected {% elif
                                mode=='edit' and student and student.admission_session_id==year %} selected {% endif %}
                                class="bg-gray-800">
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                            <i class="fas fa-calendar-alt text-gray-500"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Admission Class -->
                <div class="form-field">
                    <label for="Admission_Class" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Admission Class
                    </label>
                    <div class="relative">
                        <select id="Admission_Class" name="Admission_Class"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300 appearance-none"
                            required>
                            <option value="" class="bg-gray-800">Select Class</option>
                            {% for class_id, class_name in classes.items() %}
                            <option value="{{ class_id }}" {{ 'selected' if student and
                                student.Admission_Class==class_id|int else '' }} class="bg-gray-800">
                                {{ class_name }}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                            <i class="fas fa-chalkboard-teacher text-gray-500"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Current Class -->
                <div class="form-field">
                    <label for="CLASS" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Current Class
                    </label>
                    <div class="relative">
                        <select id="CLASS" name="CLASS"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300 appearance-none"
                            {{ 'disabled' if mode=='add' else '' }} required>
                            <option value="" class="bg-gray-800">Select Class</option>
                            {% for class_id, class_name in classes.items() %}
                            <option value="{{ class_id }}" {{ 'selected' if student and student.class_id==class_id|int
                                else '' }} class="bg-gray-800">
                                {{ class_name }}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                            <i class="fas fa-school text-gray-500"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Roll Number -->
                <div class="form-field">
                    <label for="ROLL" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Roll No
                    </label>
                    <div class="relative">
                        <input type="number" id="ROLL" name="ROLL"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.ROLL if student and student.ROLL else '' }}" required
                            placeholder="Enter roll number">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-hashtag"></i>
                        </div>
                    </div>
                    <div id="rollHint" class="text-sm text-gray-500 mt-2"></div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- SR Number -->
                <div class="form-field">
                    <label for="SR" class="block text-sm font-medium text-gray-300 mb-2 required">
                        SR No.
                    </label>
                    <div class="relative">
                        <input type="number" id="SR" name="SR"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.SR if student and student.SR else (default_sr if mode == 'add' else '') }}"
                            required placeholder="Enter SR number">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-file-alt"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Admission Number -->
                <div class="form-field">
                    <label for="ADMISSION_NO" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Admission No.
                    </label>
                    <div class="relative">
                        <input type="number" id="ADMISSION_NO" name="ADMISSION_NO"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.ADMISSION_NO if student and student.ADMISSION_NO else (default_admission_no if mode == 'add' else '') }}"
                            required placeholder="Enter admission number">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-id-badge"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- Admission Date -->
                <div class="form-field">
                    <label for="ADMISSION_DATE" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Admission Date
                    </label>
                    <div class="relative">
                        <input type="text" id="ADMISSION_DATE" name="ADMISSION_DATE"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.ADMISSION_DATE.strftime('%d-%m-%Y') if student and student.ADMISSION_DATE else (default_admission_date if mode == 'add' else '') }}"
                            required placeholder="DD-MM-YYYY">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- PEN Number -->
                <div class="form-field">
                    <label for="PEN" class="block text-sm font-medium text-gray-300 mb-2">
                        PEN No.
                    </label>
                    <div class="relative">
                        <input type="text" id="PEN" name="PEN"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.PEN if student and student.PEN else '' }}" placeholder="Enter PEN number"
                            maxlength="11">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-passport"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <!-- APAAR Number -->
                <div class="form-field">
                    <label for="APAAR" class="block text-sm font-medium text-gray-300 mb-2">
                        APAAR No.
                    </label>
                    <div class="relative">
                        <input type="text" id="APAAR" name="APAAR"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all duration-300"
                            value="{{ student.APAAR if student and student.APAAR else '' }}"
                            placeholder="Enter APAAR number" maxlength="12">
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                            <i class="fas fa-qrcode"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Guardian Information Card -->
        <div class="section-card gradient-border rounded-2xl p-4 sm:p-6 bg-gray-900/50 backdrop-blur-sm">
            <!-- Card Header -->
            <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-8">
                <div class="relative">
                    <div
                        class="w-10 h-10 sm:w-14 sm:h-14 rounded-lg sm:rounded-xl bg-gradient-to-br from-amber-600 to-orange-700 flex items-center justify-center shadow-lg">
                        <i class="fas fa-users text-white text-base sm:text-xl"></i>
                    </div>
                    <div
                        class="absolute -top-1 -right-1 w-5 h-5 sm:w-6 sm:h-6 rounded-full bg-amber-500 border-2 border-gray-900 flex items-center justify-center">
                        <span class="text-xs font-bold text-white">3</span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl sm:text-2xl font-bold text-white">Guardian Information</h2>
                    <p class="text-gray-400 text-sm">Parent or guardian details</p>
                </div>
            </div>

            <!-- Guardian Form Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                <!-- Father Information -->
                <div class="lg:col-span-1 md:col-span-2">
                    <div class="p-4 rounded-xl bg-gray-800/30 border border-gray-800">
                        <h3 class="text-base sm:text-lg font-semibold text-amber-400 mb-4 flex items-center gap-2">
                            <i class="fas fa-male"></i>
                            Father Details
                        </h3>
                        <div class="space-y-4">
                            <!-- Father Name -->
                            <div class="form-field">
                                <label for="FATHERS_NAME" class="block text-sm font-medium text-gray-300 mb-2 required">
                                    Name
                                </label>
                                <div class="relative">
                                    <input type="text" id="FATHERS_NAME" name="FATHERS_NAME"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500 transition-all duration-300"
                                        value="{{ student.FATHERS_NAME if student and student.FATHERS_NAME else '' }}"
                                        required placeholder="Father's name"
                                        oninput="this.value = this.value.replace(/\b\w/g, c => c.toUpperCase())">
                                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                        <i class="fas fa-user-tie"></i>
                                    </div>
                                </div>
                                <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>

                            <!-- Father Aadhar -->
                            <div class="form-field">
                                <label for="FATHERS_AADHAR" class="block text-sm font-medium text-gray-300 mb-2">
                                    Aadhar Number
                                </label>
                                <div class="relative">
                                    <input type="text" id="FATHERS_AADHAR" name="FATHERS_AADHAR"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500 transition-all duration-300"
                                        value="{{ student.FATHERS_AADHAR if student and student.FATHERS_AADHAR else '' }}"
                                        placeholder="XXXX XXXX XXXX" maxlength="14">
                                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                        <i class="fas fa-fingerprint"></i>
                                    </div>
                                </div>
                                <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>

                            <!-- Father Education & Occupation -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="form-field">
                                    <label for="FATHERS_EDUCATION" class="block text-sm font-medium text-gray-300 mb-2">
                                        Qualification
                                    </label>
                                    <select id="FATHERS_EDUCATION" name="FATHERS_EDUCATION"
                                        class="w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500 transition-all duration-300 text-sm">
                                        <option value="" class="bg-gray-800">Select</option>
                                        {% for option in education_options %}
                                        <option value="{{ option }}" {{ 'selected' if student and
                                            student.FATHERS_EDUCATION==option else '' }} class="bg-gray-800">{{ option
                                            }}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>

                                <div class="form-field">
                                    <label for="FATHERS_OCCUPATION"
                                        class="block text-sm font-medium text-gray-300 mb-2">
                                        Occupation
                                    </label>
                                    <select id="FATHERS_OCCUPATION" name="FATHERS_OCCUPATION"
                                        class="w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500 transition-all duration-300 text-sm">
                                        <option value="" class="bg-gray-800">Select</option>
                                        {% for option in fathers_occupation_options %}
                                        <option value="{{ option }}" {{ 'selected' if student and
                                            student.FATHERS_OCCUPATION==option else '' }} class="bg-gray-800">{{ option
                                            }}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mother Information -->
                <div class="lg:col-span-1 md:col-span-2">
                    <div class="p-4 rounded-xl bg-gray-800/30 border border-gray-800">
                        <h3 class="text-base sm:text-lg font-semibold text-pink-400 mb-4 flex items-center gap-2">
                            <i class="fas fa-female"></i>
                            Mother Details
                        </h3>
                        <div class="space-y-4">
                            <!-- Mother Name -->
                            <div class="form-field">
                                <label for="MOTHERS_NAME" class="block text-sm font-medium text-gray-300 mb-2 required">
                                    Name
                                </label>
                                <div class="relative">
                                    <input type="text" id="MOTHERS_NAME" name="MOTHERS_NAME"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-pink-500/50 focus:border-pink-500 transition-all duration-300"
                                        value="{{ student.MOTHERS_NAME if student and student.MOTHERS_NAME else '' }}"
                                        required placeholder="Mother's name"
                                        oninput="this.value = this.value.replace(/\b\w/g, c => c.toUpperCase())">
                                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                        <i class="fas fa-female"></i>
                                    </div>
                                </div>
                                <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>

                            <!-- Mother Aadhar -->
                            <div class="form-field">
                                <label for="MOTHERS_AADHAR" class="block text-sm font-medium text-gray-300 mb-2">
                                    Aadhar Number
                                </label>
                                <div class="relative">
                                    <input type="text" id="MOTHERS_AADHAR" name="MOTHERS_AADHAR"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-pink-500/50 focus:border-pink-500 transition-all duration-300"
                                        value="{{ student.MOTHERS_AADHAR if student and student.MOTHERS_AADHAR else '' }}"
                                        placeholder="XXXX XXXX XXXX" maxlength="14">
                                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                        <i class="fas fa-fingerprint"></i>
                                    </div>
                                </div>
                                <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>

                            <!-- Mother Education & Occupation -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="form-field">
                                    <label for="MOTHERS_EDUCATION" class="block text-sm font-medium text-gray-300 mb-2">
                                        Qualification
                                    </label>
                                    <select id="MOTHERS_EDUCATION" name="MOTHERS_EDUCATION"
                                        class="w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-pink-500/50 focus:border-pink-500 transition-all duration-300 text-sm">
                                        <option value="" class="bg-gray-800">Select</option>
                                        {% for option in education_options %}
                                        <option value="{{ option }}" {{ 'selected' if student and
                                            student.MOTHERS_EDUCATION==option else '' }} class="bg-gray-800">{{ option
                                            }}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>

                                <div class="form-field">
                                    <label for="MOTHERS_OCCUPATION"
                                        class="block text-sm font-medium text-gray-300 mb-2">
                                        Occupation
                                    </label>
                                    <select id="MOTHERS_OCCUPATION" name="MOTHERS_OCCUPATION"
                                        class="w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-pink-500/50 focus:border-pink-500 transition-all duration-300 text-sm">
                                        <option value="" class="bg-gray-800">Select</option>
                                        {% for option in mothers_occupation_options %}
                                        <option value="{{ option }}" {{ 'selected' if student and
                                            student.MOTHERS_OCCUPATION==option else '' }} class="bg-gray-800">{{ option
                                            }}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="lg:col-span-1 md:col-span-2">
                    <div class="p-4 rounded-xl bg-gray-800/30 border border-gray-800">
                        <h3 class="text-base sm:text-lg font-semibold text-emerald-400 mb-4 flex items-center gap-2">
                            <i class="fas fa-phone"></i>
                            Contact Details
                        </h3>
                        <div class="space-y-4">
                            <!-- Phone -->
                            <div class="form-field">
                                <label for="PHONE" class="block text-sm font-medium text-gray-300 mb-2 required">
                                    Phone Number
                                </label>
                                <div class="relative">
                                    <input type="tel" id="PHONE" name="PHONE"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all duration-300"
                                        value="{{ student.PHONE if student and student.PHONE else '' }}" required
                                        placeholder="10-digit mobile number" maxlength="10">
                                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                </div>
                                <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>

                            <!-- Alternate Mobile -->
                            <div class="form-field">
                                <label for="ALT_MOBILE" class="block text-sm font-medium text-gray-300 mb-2">
                                    Alternate Mobile
                                </label>
                                <div class="relative">
                                    <input type="tel" id="ALT_MOBILE" name="ALT_MOBILE"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all duration-300"
                                        value="{{ student.ALT_MOBILE if student and student.ALT_MOBILE else '' }}"
                                        placeholder="Alternate mobile number" maxlength="10">
                                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                        <i class="fas fa-phone-alt"></i>
                                    </div>
                                </div>
                                <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>

                            <!-- Email -->
                            <div class="form-field">
                                <label for="EMAIL" class="block text-sm font-medium text-gray-300 mb-2">
                                    Email ID
                                </label>
                                <div class="relative">
                                    <input type="email" id="EMAIL" name="EMAIL"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all duration-300"
                                        value="{{ student.EMAIL if student and student.EMAIL else '' }}"
                                        placeholder="Email address">
                                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                        <i class="fas fa-envelope"></i>
                                    </div>
                                </div>
                                <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Address and Additional Info Card -->
        <div class="section-card gradient-border rounded-2xl p-4 sm:p-6 bg-gray-900/50 backdrop-blur-sm">
            <!-- Card Header -->
            <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-8">
                <div class="relative">
                    <div
                        class="w-10 h-10 sm:w-14 sm:h-14 rounded-lg sm:rounded-xl bg-gradient-to-br from-emerald-600 to-teal-700 flex items-center justify-center shadow-lg">
                        <i class="fas fa-home text-white text-base sm:text-xl"></i>
                    </div>
                    <div
                        class="absolute -top-1 -right-1 w-5 h-5 sm:w-6 sm:h-6 rounded-full bg-emerald-500 border-2 border-gray-900 flex items-center justify-center">
                        <span class="text-xs font-bold text-white">4</span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl sm:text-2xl font-bold text-white">Address & Additional Information</h2>
                    <p class="text-gray-400 text-sm">Residential address and other details</p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Address -->
                <div class="form-field">
                    <label for="ADDRESS" class="block text-sm font-medium text-gray-300 mb-2 required">
                        Home Address
                    </label>
                    <div class="relative">
                        <textarea id="ADDRESS" name="ADDRESS" rows="3"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all duration-300 resize-none"
                            required placeholder="Enter complete home address"
                            oninput="this.value = this.value.replace(/\b\w/g, c => c.toUpperCase())">{{ student.ADDRESS if student and student.ADDRESS else '' }}</textarea>
                        <div class="absolute right-3 top-3 text-gray-500">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                    </div>
                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-circle"></i>
                        <span></span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 sm:gap-6">
                    <!-- PIN Code -->
                    <div class="form-field">
                        <label for="PIN" class="block text-sm font-medium text-gray-300 mb-2 required">
                            PIN Code
                        </label>
                        <div class="relative">
                            <input type="number" id="PIN" name="PIN"
                                class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all duration-300"
                                value="{{ student.PIN if student and student.PIN else '' }}" required
                                placeholder="6-digit PIN" maxlength="6">
                            <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                <i class="fas fa-map-pin"></i>
                            </div>
                        </div>
                        <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                            <i class="fas fa-exclamation-circle"></i>
                            <span></span>
                        </div>
                    </div>

                    <!-- Home Distance -->
                    <div class="form-field">
                        <label for="Home_Distance" class="block text-sm font-medium text-gray-300 mb-2">
                            Home Distance
                        </label>
                        <select id="Home_Distance" name="Home_Distance"
                            class="w-full px-4 py-3 sm:py-3.5 bg-gray-800/70 border border-gray-700 rounded-lg sm:rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all duration-300 appearance-none">
                            <option value="" class="bg-gray-800">Select Distance</option>
                            {% for option in home_distance_options %}
                            <option value="{{ option }}" {{ 'selected' if student and student.Home_Distance==option
                                else '' }} class="bg-gray-800">{{ option }}</option>
                            {% endfor %}
                        </select>
                        <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                            <i class="fas fa-exclamation-circle"></i>
                            <span></span>
                        </div>
                    </div>
                </div>

                <!-- Previous School Information -->
                <div class="mt-4 pt-6 border-t border-gray-800">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-300 mb-4">Previous School Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6">
                        <div class="form-field">
                            <label for="Previous_School_Name" class="block text-sm font-medium text-gray-300 mb-2">
                                School Name
                            </label>
                            <div class="relative">
                                <input type="text" id="Previous_School_Name" name="Previous_School_Name"
                                    class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all duration-300"
                                    value="{{ student.Previous_School_Name if student and student.Previous_School_Name else '' }}"
                                    placeholder="Previous school name"
                                    oninput="this.value = this.value.replace(/\b\w/g, c => c.toUpperCase())">
                                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                    <i class="fas fa-school"></i>
                                </div>
                            </div>
                            <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                <span></span>
                            </div>
                        </div>

                        <div class="form-field">
                            <label for="Previous_School_Marks" class="block text-sm font-medium text-gray-300 mb-2">
                                Marks (%)
                            </label>
                            <div class="relative">
                                <input type="number" id="Previous_School_Marks" name="Previous_School_Marks"
                                    class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all duration-300"
                                    value="{{ student.Previous_School_Marks if student and student.Previous_School_Marks else '' }}"
                                    placeholder="Percentage" maxlength="3">
                                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                    <span class="text-sm">%</span>
                                </div>
                            </div>
                            <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                <span></span>
                            </div>
                        </div>

                        <div class="form-field">
                            <label for="Previous_School_Attendance"
                                class="block text-sm font-medium text-gray-300 mb-2">
                                Attendance (days)
                            </label>
                            <div class="relative">
                                <input type="number" id="Previous_School_Attendance" name="Previous_School_Attendance"
                                    class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all duration-300"
                                    value="{{ student.Previous_School_Attendance if student and student.Previous_School_Attendance else '' }}"
                                    placeholder="Percentage" maxlength="3">
                                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                                    <i class="fas fa-clipboard-check"></i>
                                </div>
                            </div>
                            <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                <i class="fas fa-exclamation-circle"></i>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RTE Section -->
                <div class="mt-6 pt-6 border-t border-gray-800">
                    <div
                        class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-4 mobile-section-header">
                        <div class="flex items-center gap-3 w-full sm:w-auto">
                            <div
                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-violet-600 to-purple-700 flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-hand-holding-heart text-white"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-base sm:text-lg font-semibold text-white">RTE (Right to Education)</h3>
                                <p class="text-gray-400 text-xs sm:text-sm">Scholarship and financial aid information
                                </p>
                            </div>
                        </div>
                        <label class="custom-checkbox flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="is_RTE" name="is_RTE" value="true" {{ 'checked' if student and
                                rte_info and rte_info.is_RTE else '' }} class="hidden">
                            <span class="checkmark"></span>
                            <span class="text-gray-300 text-sm sm:text-base">Student is under RTE?</span>
                        </label>
                    </div>

                    <!-- RTE Fields (Conditional) -->
                    <div id="rteFields"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mt-6 {{ 'hidden' if not (student and rte_info and rte_info.is_RTE) else '' }}">
                        <!-- Bank Details -->
                        <div class="md:col-span-2 lg:col-span-3">
                            <h4 class="text-sm sm:text-md font-semibold text-violet-400 mb-4">Bank Account Details</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                                <div class="form-field">
                                    <label for="account_number" class="block text-sm font-medium text-gray-300 mb-2">
                                        Account Number
                                    </label>
                                    <input type="text" id="account_number" name="account_number"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 transition-all duration-300"
                                        value="{{ rte_info.account_number if rte_info and rte_info.account_number else '' }}"
                                        placeholder="Bank account number">
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>

                                <div class="form-field">
                                    <label for="ifsc" class="block text-sm font-medium text-gray-300 mb-2">
                                        IFSC Code
                                    </label>
                                    <input type="text" id="ifsc" name="ifsc"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 transition-all duration-300"
                                        value="{{ rte_info.ifsc if rte_info and rte_info.ifsc else '' }}"
                                        placeholder="IFSC code" oninput="this.value = this.value.toUpperCase()">
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>

                                <div class="form-field">
                                    <label for="bank_name" class="block text-sm font-medium text-gray-300 mb-2">
                                        Bank Name
                                    </label>
                                    <input type="text" id="bank_name" name="bank_name"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 transition-all duration-300"
                                        value="{{ rte_info.bank_name if rte_info and rte_info.bank_name else '' }}"
                                        placeholder="Bank name"
                                        oninput="this.value = this.value.replace(/\b\w/g, c => c.toUpperCase())">
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>

                                <div class="form-field">
                                    <label for="bank_branch" class="block text-sm font-medium text-gray-300 mb-2">
                                        Bank Branch
                                    </label>
                                    <input type="text" id="bank_branch" name="bank_branch"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 transition-all duration-300"
                                        value="{{ rte_info.bank_branch if rte_info and rte_info.bank_branch else '' }}"
                                        placeholder="Branch name"
                                        oninput="this.value = this.value.replace(/\b\w/g, c => c.toUpperCase())">
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>

                                <div class="form-field">
                                    <label for="account_holder" class="block text-sm font-medium text-gray-300 mb-2">
                                        Account Holder
                                    </label>
                                    <input type="text" id="account_holder" name="account_holder"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 transition-all duration-300"
                                        value="{{ rte_info.account_holder if rte_info and rte_info.account_holder else '' }}"
                                        placeholder="Account holder name"
                                        oninput="this.value = this.value.replace(/\b\w/g, c => c.toUpperCase())">
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>

                                <div class="form-field">
                                    <label for="RTE_registered_year"
                                        class="block text-sm font-medium text-gray-300 mb-2">
                                        RTE Registered Year
                                    </label>
                                    <input type="number" id="RTE_registered_year" name="RTE_registered_year"
                                        class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 transition-all duration-300"
                                        value="{{ rte_info.RTE_registered_year if rte_info and rte_info.RTE_registered_year else '' }}"
                                        placeholder="YYYY">
                                    <div class="error-message hidden text-red-400 text-sm mt-2 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Photo Card -->
        <div class="section-card gradient-border rounded-2xl p-4 sm:p-6 bg-gray-900/50 backdrop-blur-sm">
            <!-- Card Header -->
            <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-8">
                <div class="relative">
                    <div
                        class="w-10 h-10 sm:w-14 sm:h-14 rounded-lg sm:rounded-xl bg-gradient-to-br from-rose-600 to-pink-700 flex items-center justify-center shadow-lg">
                        <i class="fas fa-camera text-white text-base sm:text-xl"></i>
                    </div>
                    <div
                        class="absolute -top-1 -right-1 w-5 h-5 sm:w-6 sm:h-6 rounded-full bg-rose-500 border-2 border-gray-900 flex items-center justify-center">
                        <span class="text-xs font-bold text-white">5</span>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl sm:text-2xl font-bold text-white">Profile Photo</h2>
                    <p class="text-gray-400 text-sm">Upload student's profile picture</p>
                </div>
            </div>

            <div class="max-w-lg mx-auto">
                {% from "html-components/image-uploader.html" import render_image_uploader %}
                {% set image_url = 'https://lh3.googleusercontent.com/d/' ~ student.IMAGE if student and student.IMAGE
                else '' %}
                {{ render_image_uploader(unique_suffix='_' ~ mode ~ '_' ~ (student.id | string), label='Upload or
                capture photo', image_url=image_url, icon='fas fa-cloud-upload-alt') }}
            </div>
        </div>
    </form>
</div>

<!-- Responsive Sticky / Floating Form Actions -->
<div class="fixed bottom-0 left-0 right-0
         md:left-auto md:right-6 md:bottom-6
         z-50">

    <div class="max-w-6xl mx-auto md:mx-0
           px-4 sm:px-6 md:px-0">

        <div class="bg-[#161616]
             border-t border-gray-800
             md:border md:border-gray-700
             shadow-[0_-6px_20px_rgba(0,0,0,0.6)]
             md:shadow-2xl
             rounded-t-xl md:rounded-xl
             px-4 py-3">

            <div class="flex flex-col items-center gap-2
               md:items-stretch md:min-w-[240px]">

                <!-- Guidance text -->
                <p class="text-xs text-gray-400 text-center md:text-left leading-snug">
                    Review all details, then submit the form to continue.
                </p>

                <!-- Primary CTA -->
                <button type="button" id="FormSubmit" class="w-full md:w-full
                       px-6 py-2.5 rounded-lg
                       bg-green-600 hover:bg-green-500
                       text-white font-semibold text-sm
                       transition shadow-md
                       flex items-center justify-center gap-2">

                    <!-- Spinner -->
                    <svg id="btn-spinner" class="hidden animate-spin w-4 h-4" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" />
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0
                     C5.373 0 0 5.373 0 12h4z" />
                    </svg>

                    <!-- Button text -->
                    <span id="btn-text">
                        {{ 'Update Student' if mode == 'edit' else 'Save & Review' }}
                    </span>
                </button>

            </div>
        </div>
    </div>
</div>


<!-- Verification Modal (for add mode) -->
{% if mode == 'add' %}
{{ student_detail_modal(mode='admission') }}
{% endif %}


<div id="successModal" class="fixed inset-0 bg-black/80 backdrop-blur-lg z-[100] hidden">
    <div class="modal-wrapper w-full">
        <div
            class="modal-animate-in w-full max-w-md bg-gradient-to-br from-gray-900 to-gray-950 rounded-xl sm:rounded-2xl border border-gray-800/50 shadow-2xl overflow-hidden mx-4">
            <div class="p-6 sm:p-8 text-center">
                <!-- Success Icon -->
                <div class="relative inline-block mb-4 sm:mb-6">
                    <div
                        class="w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-emerald-600 to-teal-600 flex items-center justify-center mx-auto shadow-lg animate-bounce">
                        <i class="fas fa-check text-white text-xl sm:text-2xl"></i>
                    </div>
                    <div
                        class="absolute -top-1 -right-1 sm:-top-2 sm:-right-2 w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center border-4 border-gray-900 animate-pulse">
                        <i class="fas fa-star text-white text-xs"></i>
                    </div>
                </div>

                <!-- Success Message -->
                <h3 class="text-xl sm:text-2xl font-bold text-white mb-3">
                    {{ 'Student Updated!' if mode == 'edit' else 'Student Added Successfully!' }}
                </h3>
                <p class="text-gray-400 mb-6 sm:mb-8 text-sm sm:text-base" id="successMessage">
                    {{ 'Student information has been successfully updated.' if mode == 'edit' else 'Student has been
                    added to the system successfully.' }}
                </p>

                <!-- Action Buttons -->
                <div class="flex flex-col gap-3">
                    <button id='printFormBTN'
                        class="group px-4 sm:px-6 py-3 sm:py-3.5 rounded-lg sm:rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold transition-all duration-300 hover:shadow-xl hover:scale-105 inline-flex items-center justify-center gap-2 text-sm sm:text-base">
                        <i class="fas fa-print"></i>
                        Print Admission Form
                        <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                    </button>

                    {% if mode == 'add' %}
                    <button id="sendWhatsAppBTN"
                        class="group px-4 sm:px-6 py-3 sm:py-3.5 rounded-lg sm:rounded-xl bg-gradient-to-r from-green-600 to-emerald-600 text-white font-semibold transition-all duration-300 hover:shadow-xl hover:scale-105 inline-flex items-center justify-center gap-2 text-sm sm:text-base">
                        <i class="fab fa-whatsapp"></i>
                        Send WhatsApp
                        <i class="fas fa-paper-plane group-hover:translate-x-1 transition-transform"></i>
                    </button>
                    {% endif %}

                    <button onclick="closeModal('successModal')"
                        class="px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg sm:rounded-xl bg-gray-800 hover:bg-gray-700 border border-gray-700 text-gray-300 hover:text-white transition-all duration-300 font-medium text-sm sm:text-base">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    window.MODE = '{{ mode }}';
    window.STUDENT_ID = '{{ student.id if student else "" }}';
</script>

<script src="{{ url_for('static', filename='watsappMessage.js') }}"></script>
<script src="{{ url_for('static', filename='printAdmissionForm.js') }}"></script>
<script src="{{ url_for('static', filename='student_form.js') }}"></script>

<script>
    // Show/hide sticky actions based on scroll

    function closeModal(modalID) {
        document.getElementById(modalID).classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
    }

</script>

{% endblock %}